# Configuração Nginx para Nota Fiscal em Produção
# Adicione esta configuração ao seu arquivo nginx.conf

# Configuração para servir o frontend e proxy das APIs
server {
    listen 80;
    server_name rastreio.seudominio.com;  # Substitua pelo seu domínio
    
    # Servir arquivos estáticos do frontend
    location / {
        root /caminho/para/dist;  # Substitua pelo caminho do build do frontend
        try_files $uri $uri/ /index.html;
        
        # Headers para SPA
        add_header Cache-Control "no-cache, no-store, must-revalidate";
        add_header Pragma "no-cache";
        add_header Expires "0";
    }
    
    # Proxy para APIs do backend
    location /api/ {
        proxy_pass http://localhost:3001/api/;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
        
        # Headers CORS se necessário
        add_header Access-Control-Allow-Origin *;
        add_header Access-Control-Allow-Methods "GET, POST, OPTIONS";
        add_header Access-Control-Allow-Headers "Content-Type, Authorization";
        
        # Timeout settings
        proxy_connect_timeout 60s;
        proxy_send_timeout 60s;
        proxy_read_timeout 60s;
    }
    
    # Configuração específica para nota fiscal
    location /invoice/ {
        root /caminho/para/dist;  # Substitua pelo caminho do build do frontend
        try_files $uri $uri/ /index.html;
    }
    
    # Configuração para rastreamento
    location /tracking/ {
        root /caminho/para/dist;  # Substitua pelo caminho do build do frontend
        try_files $uri $uri/ /index.html;
    }
}

# Configuração HTTPS (recomendado para produção)
server {
    listen 443 ssl;
    server_name rastreio.seudominio.com;  # Substitua pelo seu domínio
    
    # Certificados SSL (configure conforme necessário)
    ssl_certificate /caminho/para/certificado.crt;
    ssl_certificate_key /caminho/para/chave.key;
    
    # Mesmas configurações do servidor HTTP acima
    location / {
        root /caminho/para/dist;
        try_files $uri $uri/ /index.html;
    }
    
    location /api/ {
        proxy_pass http://localhost:3001/api/;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
    }
    
    location /invoice/ {
        root /caminho/para/dist;
        try_files $uri $uri/ /index.html;
    }
    
    location /tracking/ {
        root /caminho/para/dist;
        try_files $uri $uri/ /index.html;
    }
}
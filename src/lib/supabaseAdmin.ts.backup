import { createClient } from '@supabase/supabase-js';

let supabaseUrl: string;
let supabaseServiceRoleKey: string;

// Verifica se estamos em um ambiente Vite (frontend)
if (typeof import.meta !== 'undefined' && import.meta.env) {
  supabaseUrl = import.meta.env.VITE_SUPABASE_URL as string;
  supabaseServiceRoleKey = import.meta.env.VITE_SUPABASE_SERVICE_ROLE_KEY as string;
} else {
  // Assume ambiente Node.js (backend/worker)
  supabaseUrl = process.env.VITE_SUPABASE_URL as string;
  supabaseServiceRoleKey = process.env.SUPABASE_SERVICE_ROLE_KEY as string;
}

if (!supabaseUrl || !supabaseServiceRoleKey) {
  console.error("VITE_SUPABASE_URL:", supabaseUrl);
  throw new Error("Configuração administrativa do banco de dados incompleta.");
}

// Exporta o cliente de serviço (admin), que ignora as policies RLS
// DEVE SER USADO APENAS NO BACKEND/SERVIDOR
export const supabaseAdmin = createClient(supabaseUrl, supabaseServiceRoleKey, {
  auth: {
    autoRefreshToken: false,
    persistSession: false
  }
});